name: Sync Docs to Website

on:
  push:
    branches:
      - main
    paths:
      - 'docs/user-guide/**'
  workflow_dispatch:

concurrency:
  group: sync-docs
  cancel-in-progress: true

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout companion repository
        uses: actions/checkout@v4
        with:
          path: companion

      - name: Checkout website repository
        uses: actions/checkout@v4
        with:
          repository: bitfocus/website
          token: ${{ secrets.SYNC_DOCS_PAT }}
          path: website

      - name: Sync user-guide folder
        run: |
          # Remove existing user-guide folder in website
          rm -rf website/user-guide

          # Copy user-guide from companion to website
          cp -r companion/docs/user-guide website/user-guide

          # Create the marker file
          touch website/user-guide/__DO_NOT_EDIT__

      - name: Commit and push changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          repository: website
          commit_message: 'Sync user-guide from companion'
          file_pattern: 'user-guide/**'
